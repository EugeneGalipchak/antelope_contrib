.TH STA_FINAL_TO_DMC 1 "$Date$"
.SH NAME
sta_final_to_dmc \- combines data final station baler data with data collected on the rt system and sends to orb
.SH SYNOPSIS
.nf
\fBsta_final_to_dmc \fP [-v] [-V] [-n]
                  [-c \fIorbclient\fP] [-p \fIpf\fP] [-m \fImail_to\fP]  
                  \fImseed_orb\fP \fIsta\fP [\fIsta_1 sta_2\fP ...]
.fi
.SH DESCRIPTION
\fBsta_final_to_dmc\fP is designed to take final station baler data prepared by 
\fBsta_final_prep\fP and combine these data with rt station data prepared by \fBsta_final_wfdisc\fP
to build the most complete data set possible throughout the operation of the station.  The sta 
database can contain seismic data, as well as state-of-health and status data.  All waveform data 
in the database are sent to an orb using the program \fBobsip2orb\fP, the content of the original 
miniseed blocketts is unaltered.  If a gap table exists for the baler data, then an attempt is made
to fill these gaps with data that exists in the rt database.  In addition, miniseed data from the 
non-waveform \fInon_wf_chan\fP channels are also sent using the program \fBminiseed2orb\fP.

\fBsta_final_to_dmc\fP works best if the \fImseed_orb\fP is sized to be bigger than one complete
station of data.  If this is the case, then the data are sent to the orb unthrottled.  Once a station
is completely sent to the \fImseed_orb\fP, then a wait is enforced until the \fIorbclient\fP has 
extracted all that station data from the orb.  Once completed a sync file generated by \fBdb2sync\fP
is also sent to the orb using \fBorbxfer2\fP.

After the sync file is sent, the next station in the input list is processed.

The assumptions of the program are that:
.IP 
css 3.0 extension tables (deployment and dmcfiles) are expected in \fIdbops\fP
.IP 
the baler data for station sta are kept in a database named \fIarchivebase/sta/sta\fP
.IP 
the wfdisc for the station rt data in a database named \fIrt_sta_dir/sta\fP
.IP 
the VH, UH, and SOH data only found in the database named \fIarchivebase/sta/sta\fP 
.IP 
\fBsta_final_to_dmc\fP is only run once per station.  If a station needs re-running, then the 
original baler database needs to be reconstructed, dmcfiles table needs editing, and the old sync
file needs to be removed.


.SH OPTIONS
.IP -v
verbose
.IP -V
Extremely verbose.  Used for debugging purposes only.
.IP -n
Test mode.  Does not execute commands.
.IP "-c orbclient"
Name of orbclient reader to track. 
The default orbclient is \fBorbmsd2days\fP.
.IP "-p parameter_file"
Name of parameter file to use.  $PFPATH is searched to find parameter file.
The default parameter file is \fBsta_final_to_dmc\fP.
.IP "-m mail_to"
email address list to send results.

.SH ENVIRONMENT
needs to have sourced $ANTELOPE/setup.csh.  
.SH PARAMETER FILE
.in 2c
.ft CW
.nf
.ne 7
.IP archivebase
Absolute path name for directory containing station directories with station database
.IP dbops
path to dbops database which includes dmcfiles and deployment tables 
.IP non_wf_chan_proxy
channel code with of waveform file which is in the same directory as non-waveform miniseed files. 
.IP non_wf_chan
list of non-waveform miniseed channel codes to be processed.
.IP rt_sta_dir    
Absolute path name for directory containing real-time station database wfdiscs
.IP sync_dir
Absolute path name for directory to store sync files
.IP deploy_mail
email addresses to send notification of deployment table checks
.fi
.ft R
.in
.SH EXAMPLE PARAMETER FILE
.in 2c
.ft CW
.nf

archivebase        /anf/TA/wf/station_final   # absolute path name for station baler archive name

dbops              /anf/TA/dbs/dbops/usarray  # path to dbops database which includes dmcfiles 
                                              # and deployment tables 

non_wf_chan_proxy  LCQ                        # channel code with of waveform file which is in the 
                                              # same directory as non-waveform miniseed files. 

non_wf_chan        &Tbl{						
                        ACE
                        LOG
                        OCF
                   }                          # list of non-waveform miniseed channel codes to be 
                                              # processed.

rt_sta_dir         /anf/TA/wf/rt_stas         # Absolute path name for directory containing 
                                              # real-time station database wfdiscs

sync_dir           /anf/TA/products/sync/sta_final     # Absolute path name for directory to store sync files

deploy_mail        flvernon@ucsd.edu,jeakins@ucsd.edu  # email addresses to send notification of 
                                                       # deployment table checks
.fi
.ft R
.in
.SH RETURN VALUES
0 if successful, 1 if not.
.SH "SEE ALSO"
.nf
db2sync(1)
miniseed2orb(1)
obsip2orb(1)
orbxfer2(1)
rt_daily_return(1)
rtmail(1)
sta_final_prep(1)
sta_final_wfdisc(1)
.fi
.SH "BUGS AND CAVEATS"
.LP
.SH AUTHOR
Frank Vernon
.br
